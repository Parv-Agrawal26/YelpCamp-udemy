<% layout('./layouts/boilerplate') %>

<!-- Map Section -->
<div class="container my-4">
  <h2 class="text-center">Campground Cluster</h2>
  <div id="map" style="height: 400px"></div>
</div>

<h1 class="text-center my-4">All Campgrounds</h1>
<div class="container">
  <a href="/campgrounds/create" class="btn btn-primary mb-4"
    >Create new Campground</a
  >
  <div class="row">
    <% campgrounds.forEach(element => { %>
    <div
      class="col-12 mb-4"
      data-lat="<%= element.lat %>"
      data-long="<%= element.long %>"
      data-name="<%= element.title %>"
      data-description="<%= element.description %>"
    >
      <div class="card d-flex flex-row">
        <img
          src="<%= element.image %>"
          class="card-img-left"
          alt="Campground image"
          style="width: 200px; height: auto"
        />
        <div class="card-body">
          <h5 class="card-title"><%= element.title %></h5>
          <p class="card-text"><%= element.description %></p>
          <p class="card-text">
            <small class="text-muted"><%= element.location %></small>
          </p>
          <p class="card-text">
            Camp made by <strong><%= element.author.name %></strong>
          </p>
          <a
            href="<%= `/campgrounds/show/${element._id}` %>"
            class="btn btn-info"
            >View <%= element.title %></a
          >
        </div>
      </div>
    </div>
    <% }); %>
  </div>
</div>

<!-- Leaflet and MarkerCluster scripts -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<script>
  // Initialize the map
  const map = L.map("map").setView([20.5937, 78.9629], 3); // Center of India; adjust as needed

  // Set up the OSM layer
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
  }).addTo(map);

  // Create a marker cluster group
  const markers = L.markerClusterGroup();

  // Select all campground divs
  const campgroundDivs = document.querySelectorAll(".row > .col-12");

  // Loop through each campground div and create markers
  campgroundDivs.forEach((div) => {
    const latitude = div.dataset.lat;
    const longitude = div.dataset.long;
    const name = div.dataset.name;
    const description = div.dataset.description;

    const marker = L.marker([latitude, longitude]).bindPopup(
      `<strong>${name}</strong><br>${description}`
    );

    markers.addLayer(marker);
  });

  // Add the marker cluster group to the map
  map.addLayer(markers);
</script>
